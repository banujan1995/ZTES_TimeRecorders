<!-- erstellt durch Jordi Schmidlin-->
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="css/style.css"">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.3.4/jspdf.debug.js"></script>
    <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
	<script src="https://code.jquery.com/jquery-1.12.4.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.js"></script> 
	<script src="/js/mycookies.js"></script> 

	
	<script>
	 createMyCookies();
	</script> 


    
    
    <title>Report</title>
	</head>
	<body style=" background-color: rgb(217, 240, 216)">
	
	<!-- Hier wird der Cookie ausgelesen und bei auth=false wird der HTML=403 aufgerufen. (BR) -->
	<script> 
		if($.cookie("auth") == "false"){
			window.location.assign("http://localhost:8081/accesserror");
		}
	</script>
    <script>
    console.log($.cookie("auth"));
    console.log($.cookie("userlogin"));
	
    </script>


    <div style="max-width: 350px; position: relative; margin: auto;">
        <img src="css/images/Logo.png" alt="Logo" class="logo" style="max-width: 350px;">
    </div>

    <br>
    <br>
    <br>
    <br>
    <br>
    <!-- Navigationsbar-->
    <ul class="navibar">
        <li class="barItem"><a class="barItem" href="http://localhost:8081/main">Home</a></li>
        <li class="barItem"><a class="barItem">Report</a></li>
        <li class="barItem"><a class="barItem" href="http://localhost:8081/absence">Absence</a></li>

        <li style="float:right" class="barItem"> <a href="javascript:void(0)" onclick="deleteUserDB(); deleteMyCookies();" class="barItem">Logout</a></li>
        <li style="float:right" class="barItem"> <a href="http://localhost:8081/profile" class="barItem">Profile</a> </li>
    </ul>


    <br>
    <div style="display: block; text-align: center;width: 100%;">
        <h1>Monthly Report</h1>
    </div>

    <form>
        <div style="display: block; text-align: center;width: 100%;">
            <label style="margin-right: 10px; font-weight: bold;" for="month">Choose report month:</label>
            <input id="chosenMonth" type="month" name="month" min="2021-01" max="2024-12" onchange="getChosenMonth()"
                required>
            <span class="validity"></span>
        </div>
    </form>

 <table id ="mitarbeiter" class="employeeTableContent"cellspacing="0" cellpadding="0" border="0" id="employeeTable" style="position: relative; margin: auto; width: 955px;">
			 <tr>
			    <th>MitarbeiterID</th>
			     <th>TagesID</th>
			    <th>Morning Start Hours</th>
			    <th>Morning End Hours</th>
			    <th>Afternoon Start Hours</th>
			    <th>Afternoon End Hours</th>
			     <th>Minus oder Plus Zeit</th>
			  </tr>
			<tbody>
			</tbody>
		</table>
		
		
		
		        <div style="display: block; text-align: center;width: 100%;">
    <button id="generatePDF" class="button" onclick="convertToPDF()"> Generate PDF</button>
</div>

    <div id="startOfExport" style="visibility: hidden; position: relative; margin: auto; width: 50px;">
      <table id ="mitarbeiterList" class="employeeTableContent"cellspacing="0" cellpadding="0" border="0" id="employeeTable" style="position: relative; margin: auto; width: 955px;">
			 <tr>
			    <th>MitarbeiterID</th>
			     <th>TagesID</th>
			    <th>Morning Start Hours</th>
			    <th>Morning End Hours</th>
			    <th>Afternoon Start Hours</th>
			    <th>Afternoon End Hours</th>
			     <th>-/+ Zeit</th>
			  </tr>
			<tbody>
			</tbody>
		</table>
  </div>

    
    

    <script>

        // nimmt angewählten Monat entgegen
        function getChosenMonth(){
            
            var month= document.getElementById("chosenMonth").value;  
            alert(month);
        }

        // erstellt eine PDF-Datei für den Export des Reports
        // full credit to: https://qawithexperts.com/article/javascript/easy-way-to-convert-html-to-pdf-using-javascript/335
        function convertToPDF(){
		var doc = new jsPDF({
		orientation: 'landscape'
		});
		doc.fromHTML(document.getElementById("startOfExport"), 20, 20, {
		'width' : 500
		},
		function (x){
		var month= document.getElementById("chosenMonth").value; 
		doc.save('report_'+month+'.pdf');
		});
		}
        
	//Hier wird der User ausser der Loginaktivitätliste herausgelöscht. (JS/BR)
		
		function deleteUserDB(){

			var username = $.cookie("userlogin").toString(); 

			console.log("Bin in der Funktion deleteUserDB" + username);
			
			$.ajax({
				type : "POST",
				url : "http://localhost:8081/timerecorders/deleteuser/",
				data : JSON.stringify({

					username : username,
					
				}),
				success : successDeleteUser,
				dataType : 'json',
				contentType : 'application/json'
			});
			window.location.href = "http://localhost:8081/login";
		
		}
		
	function successDeleteUser(response){
			
			if (response){
			console.log("Sucessful: delete active user");
			} else {
			console.log("Unsucessful: delete active user");
			}
			
		}


      


    </script>
<script>

$(document).ready(function(){
	$.getJSON("http://localhost:8081/timerecorders/timestamps/", function(data){
		var mitarbeiter_data = '';
		$.each(data, function(key, value){
			mitarbeiter_data += '<tr>';
			var mitarbeiterID = mitarbeiter_data += '<td>'+"10" +value.mitarbeiterID+ '</td>';
			var tagesid = mitarbeiter_data += '<td>'+value.tagesid+ '</td>';
			var morningstartHours = mitarbeiter_data += '<td>'+value.morningstartHours+ '</td>';
			var morningEndHours = mitarbeiter_data += '<td>'+value.morningEndHours+ '</td>';
			var afternoonStartHours = mitarbeiter_data += '<td>'+value.afternoonStartHours+ '</td>';
			var afternoonEndHours = mitarbeiter_data += '<td>'+value.afternoonEndHours+ '</td>';
			var minusOderPlusZeit = mitarbeiter_data += '<td>'+value.minusOderPlusZeit+ '</td>';
			mitarbeiter_data += '</tr>';
		});
		$('#mitarbeiterList').append(mitarbeiter_data);	
		$('#mitarbeiter').append(mitarbeiter_data);	
		
	});
	    
});

</script>

    </body>

    </html>