<!-- Erstellt durch: Jordi Schmidlin -->
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet"
	href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="stylesheet" href="css/icons.css">
<link rel="stylesheet" href="css/style.css">
<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
<title>Login</title>
</head>
<body style="background-color: rgb(217, 240, 216)">
	<header>
		<br>
		<div style="max-width: 450px; position: relative; margin: auto;">
			<img src="css/images/Logo.png" alt="Logo" class="logo"
				style="height: 100px; width: 350px;">
		</div>

		<br> <br> <br> <br> <br> <br>
		<nav>
			<label for="german" class="label_language"> Change language
				to: </label> <a href="http://localhost:8081/login"><img src="css/images/DE.jpeg"
				alt="Deutsch" name="german" style="width: 20; height: 15;"></a>
		</nav>

		<p class="title">Time Recording System</p>
		<p class="subtitle">Login</p>


	</header>
<body style="background-color: azure">

	<br>
	<br>
	<br>

	<i class="fa fa-user icon" style="display: block; text-align: center; width: 100%;"</i>
	<label for="loginUsername" class="text"><b>User name: </b></label>
	<input type="text" style="min-width: 160px; text-align: center;" placeholder="Enter user name" name="loginUsername" onkeyup="enableButton()" class="textField" id="loginUserName_EN" required>

	<br>
	<br>

	<i class="fa fa-key icon" style="display: block; text-align: center; width: 100%;"</i>
	<label for="loginPassword" class="text"><b>Password: </b></label>
	<input type="password" style="min-width: 160px; text-align: center;" placeholder="Enter password" name="loginPassword" onkeyup="enableButton()" class="textField" id="loginPassword_EN" required>

	<br>
	<br>
	<br>
	<p id="capsON_en">WARNING! Caps lock is ON.</p>
	<br>
	<br>

	<!-- Meldung, falls Benutzername oder Passwort falsch sind-->
	<!-- credits to: https://www.w3schools.com/howto/howto_js_detect_capslock.asp-->
	<div class="alert" id="wrongInputs" style="max-width: 380px; position: relative; margin: auto;">
		<span class="closebtn"onclick="this.parentElement.style.display='none';">&times;</span> 
			<strong> Incorrect password and/or user name!</strong> 
			<br> Please enter the right credentials!
	</div>
	<br>
	<br>


	<input type="checkbox" onclick="showPassword()" id="showPassword">
	Show password

	<br>
	<br>

	<div class="w3-light-grey"style="max-width: 150px; position: relative; margin: auto;">
		<div id="loginProgress" class="w3-container w3-blue  w3-center" style="width: 0%">0%</div>
	</div>
	<br>


	<button class="button" onclick="load(); checkInputs()" id="loginButton" disabled>Login</button>

	<br>
	<br>

	<footer>
		<a href="mailto:admin@jkbgmbh.ch" id="loginIssues" style="display: block; text-align: center; width: 100%;"> Login issues?</a>
	</footer>


	<script>

		//Button wird nur enabled, falls Password und User einen Wert aufweisen
    	//TODO: muss beides 端berpr端fen
    	function enableButton(){
        	document.getElementById("loginButton").disabled = false;
    	}

		//Progessbar ladet
		//credits to: https://www.w3schools.com/w3css/w3css_progressbar.asp
		function load() {
			var elem = document.getElementById("loginProgress");
			var width = 0;
			var id = setInterval(frame, 10);
			function frame() {
				if (width >= 100) {
					clearInterval(id);
				} else {
					width++;
					elem.style.width = width + '%';
					elem.innerHTML = width * 1 + '%';
				}
			}
		}

		//Macht das Passwortfeld sichtbar
		//credits to: https://www.w3schools.com/howto/howto_js_toggle_password.asp
		function showPassword() {
			var x = document.getElementById("loginPassword_EN");
			if (x.type === "password") {
				x.type = "text";
			} else {
				x.type = "password";
			}
		}

		//gibt eine Warnung an, falls Feststelltaste aktiviert ist
		//credits to: https://www.w3schools.com/howto/howto_js_detect_capslock.asp'
		var input = document.getElementById("loginPassword_EN");
		var text = document.getElementById("capsON_en");
		input.addEventListener("keyup", function(event) {

			if (event.getModifierState("CapsLock")) {
				text.style.display = "block";
			} else {
				text.style.display = "none"
			}
		});

		/* Hier wird die Credentials 
		端berpr端ft und bei Korrektur eingaben der 
		Passwort wird auf andere Seite gewechselt (BR) - ENGLISCH
		 */
		function checkInputs() {
			var user = document.getElementById("loginUserName_EN").value;
			var password = document.getElementById("loginPassword_EN").value;
			var alert = document.getElementById("wrongInputs")

			// see: https://api.jquery.com/jquery.post/

			$.ajax({
				type : "POST",
				url : "/timerecorders/mitarbeiterlogin/",
				data : JSON.stringify({
					user : user,
					password : password
				}),
				success : successCredentials,
				dataType : 'json',
				contentType : 'application/json'
			});

		}

		/* Hier ist die Antwort vom Server, welches vearbeitet wird (BR)- ENGLISCH*/

		function successCredentials(response) {
			if (response == true) {
				//$.getJSON("http://localhost:8081/timerecorders/mitarbeiterlogin/").done(
				//handleSuccessCreditals);
				handleSuccessCreditals(response);

			} else {
				//$.getJSON("http://localhost:8081/timerecorders/mitarbeiterlogin/").fail(handleFailureCreditals);
				handleFailureCreditals(response);
			}
		}

		/* Hier ist die Weiterleitung bei einer erfolgreichen oder 
		nicht erfolgreichen Eingaben der Credentials (BR) - ENGLISCH*/

		function handleSuccessCreditals(response) {
			var alert = document.getElementById("wrongInputs")

			console.log("Authorisation successful");
			alert.style.display = "none";
			window.location.href = "main_en.html";

		}

		function handleFailureCreditals(response) {
			var alert = document.getElementById("wrongInputs")

			console.log("Authorisation failure / Missing value");
			alert.style.display = "block";

		}
	</script>
	
	<script src="https://code.jquery.com/jquery-3.5.1.js"
		integrity="sha256-QWo7LDvxbWT2tbbQ97B53yJnYU3WhH/C8ycbRAkjPDc="
		crossorigin="anonymous"></script>

</body>
</html>